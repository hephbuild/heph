edition = "2023";
package heph.plugin.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/any.proto";
import "google/protobuf/descriptor.proto";
import "heph/plugin/v1/plugin.proto";
import "heph/plugin/v1/tref.proto";

message ProviderConfigRequest {
}

message ProviderConfigResponse {
  string name = 1;
}

message ListRequest {
  string request_id = 1;
  string package = 2;
}

message ListResponse {
    oneof of {
      TargetRef ref = 1;
      TargetSpec spec = 2;
    }
}

message GetContainer {
  oneof msg {
    GetRequest start = 1;
    bool cancel = 2;
  }
}

message GetRequest {
  string request_id = 1;
  TargetRef ref = 2;
  repeated ProviderState states = 3;
}

message GetResponse {
  TargetSpec spec = 1;
}

message ProbeRequest {
  string request_id = 1;
  string package = 2;
}

message ProviderState {
  string package = 1;
  string provider = 2;
  map<string, google.protobuf.Value> state = 3;
}

message ProbeResponse {
  repeated ProviderState states = 1;
}

service Provider {
  rpc Config(ProviderConfigRequest) returns (ProviderConfigResponse) {}
  rpc List(ListRequest) returns (stream ListResponse) {}
  rpc Get(stream GetContainer) returns (stream GetResponse) {}
  rpc Probe(ProbeRequest) returns (ProbeResponse) {}
}
